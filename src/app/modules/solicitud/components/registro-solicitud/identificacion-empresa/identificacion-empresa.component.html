<form [formGroup]="getChildFormGroup()">
  <div class="p-grid">
    <div class="p-col">
      <div class="form-group">
        <label>1.1 Número de Identificación Tributaria N.I.T:</label>
        <div class="icon-group">
          <input placeholder="16777719" type="number" formControlName="nit" />
          <mat-icon class="information" svgIcon="informacion-circular-negativo"
            matTooltip="Diligenciar el Número de Identificación Tributaria N.I.T. de la empresa. No se requiere dígito de verificación.">
          </mat-icon>
        </div>
        <div
          *ngIf="getChildFormGroupControl('nit').invalid && (getChildFormGroupControl('nit').dirty || getChildFormGroupControl('nit').touched)">
          <span *ngIf="getChildFormGroupControl('nit').errors?.required" class="caption ng-invalid">
            Campo obligatorio
          </span>
          <span *ngIf="getChildFormGroupControl('nit').errors?.maxLength" class="caption ng-invalid">
            Máximo 255 caracteres
          </span>
        </div>
      </div>
    </div>
    <div class="p-col">
      <div class="form-group">
        <label>1.2 Razón social:</label>
        <div class="icon-group">
          <input placeholder="JAMES OCHOA TRUJILLO" type="text" formControlName="razonSocial" />
          <mat-icon class="information" svgIcon="informacion-circular-negativo"
            matTooltip="Diligenciar la razón social de acuerdo al Certificado de Existencia y Representación Legal o Matrícula Mercantil registrados en el Registro único Empresarial y Social RUES.">
          </mat-icon>
        </div>
        <div
          *ngIf="getChildFormGroupControl('razonSocial').invalid && (getChildFormGroupControl('razonSocial').dirty || getChildFormGroupControl('razonSocial').touched)">
          <span *ngIf="getChildFormGroupControl('razonSocial').errors?.required" class="caption ng-invalid">
            Campo obligatorio
          </span>
          <span *ngIf="getChildFormGroupControl('razonSocial').errors?.maxLength" class="caption ng-invalid">
            Máximo 255 caracteres
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="p-grid">
    <div class="p-col">
      <div class="form-group">
        <label>1.3 Nombre Contacto de la Empresa:</label>
        <div class="icon-group">
          <input placeholder="Nombre Contacto" type="text" formControlName="nombreContacto" />
          <mat-icon class="information" svgIcon="informacion-circular-negativo"
            matTooltip="Diligenciar el nombre de la persona que actuará como enlace entre la empresa y el Grupo de Registro de Productores de Bienes Nacionales.">
          </mat-icon>
        </div>
        <div
          *ngIf="getChildFormGroupControl('nombreContacto').invalid && (getChildFormGroupControl('nombreContacto').dirty || getChildFormGroupControl('nombreContacto').touched)">
          <span *ngIf="getChildFormGroupControl('nombreContacto').errors?.required" class="caption ng-invalid">
            Campo obligatorio
          </span>
          <span *ngIf="getChildFormGroupControl('nombreContacto').errors?.maxLength" class="caption ng-invalid">
            Máximo 255 caracteres
          </span>
        </div>
      </div>
    </div>
    <div class="p-col">
      <div class="form-group">
        <label>1.4 Correo Electrónico:</label>
        <div class="icon-group">
          <input placeholder="usuario@dominio.com" type="text" formControlName="correo" />
          <mat-icon class="information" svgIcon="informacion-circular-negativo"
            matTooltip="Diligenciar el correo electrónico de la persona indicada como contacto en 1.3. Es muy importante que este correo electrónico sea correctamente diligenciado, porque la respuesta a la solicitud de registro o cualquier notificación relacionada con el registro es enviada a través de dicho correo.">
          </mat-icon>
        </div>
        <div
          *ngIf="getChildFormGroupControl('correo').invalid && (getChildFormGroupControl('correo').dirty || getChildFormGroupControl('correo').touched)">
          <span *ngIf="getChildFormGroupControl('correo').errors?.required" class="caption ng-invalid">
            Campo obligatorio
          </span>
          <span *ngIf="getChildFormGroupControl('correo').errors?.pattern" class="caption ng-invalid">
            Formato inválido
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="p-grid">
    <div class="p-col-2">
      <div class="form-group">
        <label>1.5 Teléfono Contacto: </label>
        <div class="icon-group">
          <input placeholder="Indicativo" type="number" formControlName="indicativo" />
          <mat-icon class="information" svgIcon="informacion-circular-negativo"
            matTooltip="Campo opcional. Digitar prefijo de la ciudad/provincia para telefonos fijos.">
          </mat-icon>
        </div>
        <div
          *ngIf="getChildFormGroupControl('indicativo').invalid && (getChildFormGroupControl('indicativo').dirty || getChildFormGroupControl('indicativo').touched)">
          <span *ngIf="getChildFormGroupControl('indicativo').errors?.pattern" class="caption ng-invalid">
            Formato de inválido
          </span>
        </div>
      </div>
    </div>
    <div class="p-col-4">
      <div class="form-group">
        <br />
        <br />
        <div class="icon-group">
          <input placeholder="Teléfono" type="number" formControlName="telefono" />
          <mat-icon class="information" svgIcon="informacion-circular-negativo"
            matTooltip="Diligenciar número telefónico del contacto de la empresa.">
          </mat-icon>
        </div>
        <div
          *ngIf="getChildFormGroupControl('telefono').invalid && (getChildFormGroupControl('telefono').dirty || getChildFormGroupControl('telefono').touched)">
          <span *ngIf="getChildFormGroupControl('telefono').errors?.required" class="caption ng-invalid">
            Campo obligatorio
          </span>
          <span *ngIf="getChildFormGroupControl('telefono').errors?.pattern" class="caption ng-invalid">
            Formato inválido
          </span>
        </div>
      </div>
    </div>
  </div>
</form>

<h2 class="headline-s">Plantas de Producción</h2>
<hr />

<form [formGroup]="formGroupPlantaProduccion">
  <div class="p-grid">
    <div class="p-col">
      <div class="form-group">
        <label>1.6 Departamento Planta de Producción:</label>
        <div class="icon-group">
          <select formControlName="departamento">
            <option hidden [value]="null">Seleccione un Departamento</option>
            <option *ngFor="let departamento of departamentos" [value]="departamento.codigo">
                {{departamento.nombre}}
            </option>
          </select>
          <mat-icon class="information" svgIcon="informacion-circular-negativo"
            matTooltip="Diligenciar el departamento de ubicación de la planta de producción del producto a registrar.">
          </mat-icon>
        </div>
      </div>
    </div>
    <div class="p-col">
      <div class="form-group">
        <label>1.7 Ciudad Planta de Producción:</label>
        <div class="icon-group">
          <select formControlName="ciudad"
            [attr.disabled]="formGroupPlantaProduccion.controls.departamento.value ? null : true">
            <option hidden [value]="null">Seleccione una Ciudad</option>
            <ng-container *ngFor="let ciudad of ciudades;">
                <option *ngIf="ciudad.departamento.codigo == formGroupPlantaProduccion.controls.departamento.value"
                    [value]="ciudad.codigo">
                    {{ciudad.nombre}}
                </option>
            </ng-container>
          </select>
          <mat-icon class="information" svgIcon="informacion-circular-negativo"
            matTooltip="Diligenciar la ciudad de ubicación de la planta de producción del producto a registrar.">
          </mat-icon>
        </div>
      </div>
    </div>
  </div>

  <div class="p-grid">
    <div class="p-col">
      <div class="form-group">
        <label>1.8 Dirección Planta de Producción:</label>
        <div class="icon-group">
          <input placeholder="Dirección" type="text" formControlName="direccion"
            [attr.disabled]="formGroupPlantaProduccion.controls.departamento.value ? null : true" />
          <mat-icon class="information" svgIcon="informacion-circular-negativo"
            matTooltip="Diligenciar la dirección de ubicación de la planta de producción del producto a registrar.">
          </mat-icon>
        </div>
        <div
          *ngIf="formGroupPlantaProduccion.controls.direccion.invalid && (formGroupPlantaProduccion.controls.direccion.dirty || formGroupPlantaProduccion.controls.direccion.touched)">
          <span *ngIf="formGroupPlantaProduccion.controls.direccion.errors?.required" class="caption ng-invalid">
            Campo obligatorio
          </span>
        </div>
      </div>
    </div>
    <div class="p-col">
      <br />
      <br />
      <button class="outlined" (click)="agregarPlanta()">AGREGAR</button>
    </div>
  </div>
</form>

<hr />

<div class="table">
  <div class="title">
    <div class="sub-title">
      <span class="spacer"></span>
      <div class="input-group">
        <input placeholder="Buscar" type="text" [(ngModel)]="busqueda" (ngModelChange)="onBuscar()" />
        <mat-icon svgIcon="buscar-circular-negativo"></mat-icon>
      </div>
    </div>
  </div>
  <p-table [value]="plantas" [customSort]="true" [lazy]="true" (onLazyLoad)="onSort($event)">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="departamento">
          <span class="headline-s --dark-primary-color">
            Departamento<p-sortIcon field="departamento"></p-sortIcon>
          </span>
        </th>
        <th pSortableColumn="ciudad">
          <span class="headline-s --dark-primary-color">
            Ciudad<p-sortIcon field="ciudad"></p-sortIcon>
          </span>
        </th>
        <th pSortableColumn="direccion">
          <span class="headline-s --dark-primary-color">
            Dirección<p-sortIcon field="direccion"></p-sortIcon>
          </span>
        </th>
        <th>
          <span class="headline-s --dark-primary-color">Eliminar</span>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-planta let-index="rowIndex">
      <tr>
        <td>
          <p class="body-uno">{{ divipolaService.consultarDepartamentos(planta.departamento).nombre}}</p>
        </td>
        <td>
          <p class="body-uno">{{divipolaService.consultarCiudades(planta.ciudad).nombre}}</p>
        </td>
        <td>
          <p class="body-uno">{{planta.direccion}}</p>
        </td>
        <td class="center">
          <mat-icon  class="pointer" svgIcon="papelera-positivo" (click)="eliminarPlanta(planta.id, index)"></mat-icon>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <div *ngIf="!plantas || plantas.length==0">
    <p class="content body-uno">No se encontraron registros coincidentes</p>
  </div>
  <p-paginator [rows]="pagina.registrosPorPagina" [totalRecords]="pagina.registrosTotales"
    (onPageChange)="onPageChange($event)"></p-paginator>
</div>
